{% extends 'design_app/base.html' %}

{% block content %}
<div class="container-fluid">
    <div class="row">
        <div class="col-12">
            <h1 class="fw-bold mb-4">–ü–∞–Ω–µ–ª—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞</h1>

            <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
            <div class="row mb-4">
                <div class="col-md-3">
                    <div class="card bg-primary text-white">
                        <div class="card-body text-center">
                            <h5 class="card-title">–í—Å–µ–≥–æ –∑–∞—è–≤–æ–∫</h5>
                            <h2 class="mb-0">{{ stats.total }}</h2>
                        </div>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="card bg-info text-white">
                        <div class="card-body text-center">
                            <h5 class="card-title">–ù–æ–≤—ã–µ</h5>
                            <h2 class="mb-0">{{ stats.new }}</h2>
                        </div>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="card bg-warning text-white">
                        <div class="card-body text-center">
                            <h5 class="card-title">–í —Ä–∞–±–æ—Ç–µ</h5>
                            <h2 class="mb-0">{{ stats.in_progress }}</h2>
                        </div>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="card bg-success text-white">
                        <div class="card-body text-center">
                            <h5 class="card-title">–í—ã–ø–æ–ª–Ω–µ–Ω–æ</h5>
                            <h2 class="mb-0">{{ stats.completed }}</h2>
                        </div>
                    </div>
                </div>
            </div>

            <!-- –ù–∞–≤–∏–≥–∞—Ü–∏—è -->
            <div class="mb-4">
                <a href="{% url 'manage_categories' %}" class="btn btn-outline-primary">
                    üìÅ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º–∏
                </a>
            </div>

            <!-- –§–∏–ª—å—Ç—Ä—ã -->
            <div class="card mb-4">
                <div class="card-body">
                    <h5 class="card-title">–§–∏–ª—å—Ç—Ä—ã</h5>
                    <form method="get" class="row g-3">
                        <div class="col-md-4">
                            <label class="form-label">–°—Ç–∞—Ç—É—Å</label>
                            <select name="status" class="form-select">
                                <option value="">–í—Å–µ —Å—Ç–∞—Ç—É—Å—ã</option>
                                <option value="NEW" {% if status_filter == 'NEW' %}selected{% endif %}>–ù–æ–≤—ã–µ</option>
                                <option value="IN_PROGRESS" {% if status_filter == 'IN_PROGRESS' %}selected{% endif %}>–ü—Ä–∏–Ω—è—Ç–æ –≤ —Ä–∞–±–æ—Ç—É</option>
                                <option value="COMPLETED" {% if status_filter == 'COMPLETED' %}selected{% endif %}>–í—ã–ø–æ–ª–Ω–µ–Ω–æ</option>
                            </select>
                        </div>
                        <div class="col-md-4">
                            <label class="form-label">–ö–∞—Ç–µ–≥–æ—Ä–∏—è</label>
                            <select name="category" class="form-select">
                                <option value="">–í—Å–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏</option>
                                {% for category in categories %}
                                <option value="{{ category.id }}" {% if category_filter == category.id|stringformat:"i" %}selected{% endif %}>
                                    {{ category.name }}
                                </option>
                                {% endfor %}
                            </select>
                        </div>
                        <div class="col-md-4 d-flex align-items-end">
                            <button type="submit" class="btn btn-primary me-2">–ü—Ä–∏–º–µ–Ω–∏—Ç—å</button>
                            <a href="{% url 'admin_dashboard' %}" class="btn btn-secondary">–°–±—Ä–æ—Å–∏—Ç—å</a>
                        </div>
                    </form>
                </div>
            </div>

            <!-- –¢–∞–±–ª–∏—Ü–∞ –∑–∞—è–≤–æ–∫ -->
            <div class="card">
                <div class="card-body">
                    <h5 class="card-title">–°–ø–∏—Å–æ–∫ –∑–∞—è–≤–æ–∫</h5>

                    {% if applications %}
                    <div class="table-responsive">
                        <table class="table table-striped table-hover">
                            <thead class="table-dark">
                                <tr>
                                    <th>–î–∞—Ç–∞</th>
                                    <th>–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å</th>
                                    <th>–ù–∞–∑–≤–∞–Ω–∏–µ</th>
                                    <th>–ö–∞—Ç–µ–≥–æ—Ä–∏—è</th>
                                    <th>–°—Ç–∞—Ç—É—Å</th>
                                    <th>–î–µ–π—Å—Ç–≤–∏—è</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for app in applications %}
                                <tr>
                                    <td>{{ app.upload_date|date:"d.m.Y H:i" }}</td>
                                    <td>{{ app.user.username }}</td>
                                    <td>{{ app.title }}</td>
                                    <td>{{ app.category.name }}</td>
                                    <td>
                                        <span class="badge
                                            {% if app.status == 'NEW' %}bg-primary
                                            {% elif app.status == 'IN_PROGRESS' %}bg-warning
                                            {% else %}bg-success{% endif %}">
                                            {{ app.get_status_display }}
                                        </span>
                                    </td>
                                    <td>
                                        <a href="{% url 'edit_application' app.id %}" class="btn btn-sm btn-outline-primary">
                                            –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å
                                        </a>
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                    {% else %}
                    <div class="text-center py-4">
                        <p class="text-muted">–ó–∞—è–≤–∫–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</p>
                    </div>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}